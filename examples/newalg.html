<!DOCTYPE html>
<html>
	<head>
		<title>Coloured terrain mesh</title>
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"/>
		<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
		<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
		<script>
			$(document).ready(function() {
				var canvas = document.getElementById("myCanvas");
				var ctx = canvas.getContext("2d");

				cols = 6;
				rows = 6;
				total_points = cols * rows;

				cell_size = 50;

				points = [];
				peaks = [14, 22, 25];

				scale = 10;

				//console.log(total_points);

				for (i = 0; i < total_points; i++) {
					points[i] = 0;
				}

				//console.log(points);

				peaks.forEach(function(peak) {
				 	points[peak-1] = Math.round(Math.random()*100,1);
				 });

				// points[14] = 10;
				// points[22] = 50;
				// points[25] = 50;

				console.log(points);

				for (i = 0; i < points.length; i++) {
					//console.log(i);
					if (i-1 > -1 && i-cols > -1 && i+1 < total_points-1 && i+cols < total_points-1) {
						//console.log('can go back 1 & 6');
						//console.log(peaks.indexOf(i));

						if (peaks.indexOf(i) > -1) {
							points[i-1] = points[i] - 1;
							points[i-cols] = points[i] - 1;
							points[i+cols] = points[i] - 1;
							points[i+1] = points[i] - 1;
						}

						if (points[i-1] == 0 && points[i] > 0) {
							mag = Math.round(points[i-1] / scale);
							points[i-1] = points[i] - mag;
						}

						if (points[i-cols] == 0 && points[i] > 0) {
							mag = Math.round(points[i-1] / scale);
							points[i-cols] = points[i] - mag;
						}

						if (points[i+cols] == 0 && points[i] > 0) {
							mag = Math.round(points[i-1] / scale);
							points[i+cols] = points[i] - mag;
						}

						if (points[i+1] == 0 && points[i] > 0) {
							mag = Math.round(points[i-1] / scale);
							points[i+1] = points[i] - mag;
						}
					}
				}

				// points[0] = 50;
				// points[1] = 40;
				// points[2] = 30;

				x = 0;
				y = 100;

				ctx.strokeStyle = "black";
				ctx.beginPath();
				ctx.moveTo(x, y);

				for (i = 0; i < points.length; i++) {

					console.log(i, points[i]);

					px = x;
					py = y - points[i];

					ctx.lineTo(px, py);
					ctx.stroke();

					if(i % cols == cols-1) {
						x = x - cell_size*(cols-2);
						y = y + cell_size/3;
						ctx.moveTo(x, y);
						console.log("new row");
					} else {
						x = px + cell_size;
						y = y;
					}
				}

			});
		</script>
	</head>
  <body>
	  <canvas width="800" height="600" id="myCanvas">
		  <!-- Insert fallback content here -->
	  </canvas>
  </body>
</html>
